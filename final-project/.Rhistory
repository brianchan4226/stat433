library(tidyverse)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year)
m = glm(upset~favO+favD+undO+undD,data=all4,family=binomial)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year)
View(results)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = results %>%
rename(Seed = seed1)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = results %>%
rename(seed1 = Seed)
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year)
library(tidyverse)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = rename(results, c(Seed1 = Seed, Score1 = Score, Team1 = Team, Team2 = Team_1, Score2 = Score_1, Seed2 = Seed_1))
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year)
kenpom = kenpom %>%
mutate("underdog" = paste(Year,Team)) %>%
mutate("favorite" = paste(Year,Team))
all4 = results %>%
left_join(kenpom,by='favorite') %>%
select(upset,favorite,underdog.x,AdjustO,AdjustD) %>%
drop_na() %>%
mutate(favO = AdjustO,
favD = AdjustD,
underdog = underdog.x) %>%
select(upset,favorite,underdog,favO,favD) %>%
left_join(kenpom,by='underdog') %>%
select(upset,favorite.x,underdog,favO,favD,AdjustO,AdjustD) %>%
mutate(undO = AdjustO,
undD = AdjustD,
favorite = favorite.x) %>%
select(upset,favorite,underdog,favO,favD,undO,undD) %>%
drop_na()
m = glm(upset~favO+favD+undO+undD,data=all4,family=binomial)
summary(m)
b0 = coef(summary(m))[1]
b1 = coef(summary(m))[2]
b2 = coef(summary(m))[3]
b3 = coef(summary(m))[4]
b4 = coef(summary(m))[5]
error = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error)
mean(error$error)
error = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error) %>%
filter(upset==1)
mean(error$error)
error = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error) %>%
filter(upset==0)
mean(error$error)
pred0 = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error) %>%
filter(pred_upset==0)
1-mean(pred0$upset)
m = glm(upset~favO,data=all4,family=binomial)
summary(m)
m.df=data.frame(favO= seq(100,130,1))
m.df$upset = predict(m,newdata=m.df,type='response')
ggplot()+
geom_point(data=all4,mapping = aes(x=favO,y=upset),alpha=.1)+
geom_line(data=m.df,aes(x=favO,y=upset))+
xlab("Adjusted Offensive Rating")+
ylab("Probability of Upset")+
ggtitle("Probabilty of Upset by Favorite's Offense")+
geom_vline(xintercept = 108,linetype='dashed')
ggplot(data=all4,mapping=aes(x=favO))+
geom_histogram(color='black',fill='white',binwidth = 2)+
ggtitle("Distribution of Favorite Offenseive Ratings")+
geom_vline(xintercept = 108,linetype='dashed')+
xlab("Adjusted Offensive Rating")
results = read_csv('mm_results.csv')
results = rename(results, c(Seed1 = Seed, Score1 = Score, Team1 = Team, Team2 = Team_1, Score2 = Score_1, Seed2 = Seed_1))
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year) %>%
drop_na()
upy = results %>%
group_by(Year) %>%
summarize(upsets = sum(upset))
ggplot(upy,aes(x=Year,y=upsets))+
geom_point()+
geom_smooth(method = 'lm',color='black',se=FALSE)+
ylab("Upsets")+
ggtitle("Upsets per Year from 1985-2019")
mean(all4$upset)
library(tidyverse)
kenpom = read_csv('kenpom.csv')
results = read_csv('mm_results.csv')
results = rename(results, c(Seed1 = Seed, Score1 = Score, Team1 = Team, Team2 = Team_1, Score2 = Score_1, Seed2 = Seed_1))
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year)
kenpom = kenpom %>%
mutate("underdog" = paste(Year,Team)) %>%
mutate("favorite" = paste(Year,Team))
all4 = results %>%
left_join(kenpom,by='favorite') %>%
select(upset,favorite,underdog.x,AdjustO,AdjustD) %>%
drop_na() %>%
mutate(favO = AdjustO,
favD = AdjustD,
underdog = underdog.x) %>%
select(upset,favorite,underdog,favO,favD) %>%
left_join(kenpom,by='underdog') %>%
select(upset,favorite.x,underdog,favO,favD,AdjustO,AdjustD) %>%
mutate(undO = AdjustO,
undD = AdjustD,
favorite = favorite.x) %>%
select(upset,favorite,underdog,favO,favD,undO,undD) %>%
drop_na()
m = glm(upset~favO+favD+undO+undD,data=all4,family=binomial)
summary(m)
b0 = coef(summary(m))[1]
b1 = coef(summary(m))[2]
b2 = coef(summary(m))[3]
b3 = coef(summary(m))[4]
b4 = coef(summary(m))[5]
error = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error)
mean(error$error)
error = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error) %>%
filter(upset==1)
mean(error$error)
error = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error) %>%
filter(upset==0)
mean(error$error)
pred0 = all4 %>%
mutate(e = exp(b0+b1*favO+b2*favD+b3*undO+b4*undD)) %>%
mutate(p = e/(1+e)) %>%
mutate(pred_upset = round(p)) %>%
mutate(error = abs(upset-pred_upset)) %>%
select(upset,pred_upset,error) %>%
filter(pred_upset==0)
1-mean(pred0$upset)
m = glm(upset~favO,data=all4,family=binomial)
summary(m)
m.df=data.frame(favO= seq(100,130,1))
m.df$upset = predict(m,newdata=m.df,type='response')
ggplot()+
geom_point(data=all4,mapping = aes(x=favO,y=upset),alpha=.1)+
geom_line(data=m.df,aes(x=favO,y=upset))+
xlab("Adjusted Offensive Rating")+
ylab("Probability of Upset")+
ggtitle("Probabilty of Upset by Favorite's Offense")+
geom_vline(xintercept = 108,linetype='dashed')
ggplot(data=all4,mapping=aes(x=favO))+
geom_histogram(color='black',fill='white',binwidth = 2)+
ggtitle("Distribution of Favorite Offenseive Ratings")+
geom_vline(xintercept = 108,linetype='dashed')+
xlab("Adjusted Offensive Rating")
results = read_csv('mm_results.csv')
results = rename(results, c(Seed1 = Seed, Score1 = Score, Team1 = Team, Team2 = Team_1, Score2 = Score_1, Seed2 = Seed_1))
results = results %>%
mutate("upset" = case_when(
((Seed1<Seed2)&(Score1>Score2))~0,
((Seed1<Seed2)&(Score1<Score2))~1,
((Seed1>Seed2)&(Score1>Score2))~1,
((Seed1>Seed2)&(Score1<Score2))~0,
)) %>%
mutate("underdog" = case_when(
(Seed1>Seed2) ~paste(Year,Team1),
(Seed1<Seed2) ~paste(Year,Team2),
)) %>%
mutate("favorite" = case_when(
(Seed1>Seed2) ~paste(Year,Team2),
(Seed1<Seed2) ~paste(Year,Team1),
)) %>%
select(upset,underdog,favorite,Round,Year) %>%
drop_na()
upy = results %>%
group_by(Year) %>%
summarize(upsets = sum(upset))
ggplot(upy,aes(x=Year,y=upsets))+
geom_point()+
geom_smooth(method = 'lm',color='black',se=FALSE)+
ylab("Upsets")+
ggtitle("Upsets per Year from 1985-2019")
mean(all4$upset)
